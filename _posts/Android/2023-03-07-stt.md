---
title: "[Android] STT"
excerpt: "Speech API ì‚¬ìš©í•˜ê¸°"
categories:
  - Android
tag:
  - Android STT
  - STT
  - Speech Api

last_modified_at: 2023-03-07
toc: true
toc_sticky: true
search: true
---

# ğŸ™‹â€â™€ï¸ STT(Speech To Text)
STTë€ ë¬´ì—‡ì¼ê¹Œ?? ì´ëŠ” **Speech To Text**ì˜ ì¤„ì„ë§ë¡œ ë§ ê·¸ëŒ€ë¡œ **ìŒì„±ì„ í…ìŠ¤íŠ¸ë¡œ ì „í™˜**í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤.

ì•ˆë“œë¡œì´ë“œì—ì„œëŠ” Speach APIë¥¼ í™œìš©í•´ STT ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

<br>

# ğŸ™‹â€â™€ï¸ Speech API ì‚¬ìš©ë²•

## â¡ï¸ í•„ìš”í•œ ê¶Œí•œ íšë“

```kotlin
    <uses-permission android:name="android.permission.RECORD_AUDIO"/>
```

<br>

## â¡ï¸ STT ì‘ì—… ì§„í–‰

ìš°ì„  sttë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ì„œ ë²„ì „ê³¼ í¼ë¯¸ì…˜ ì²´í¬ë¥¼ ì§„í–‰í•´ì•¼ í•œë‹¤.

```kotlin
    private fun isPermissionGranted(): Boolean {
        return !(Build.VERSION.SDK_INT >= 23 &&
                ContextCompat.checkSelfPermission(requireContext(), Manifest.permission.RECORD_AUDIO) != PackageManager.PERMISSION_GRANTED)
    }

    private val requestAudioLauncher = registerForActivityResult(
        ActivityResultContracts.RequestPermission()) { isGranted ->
        if (!isGranted) {
            val error = resources.getString(R.string.dialog_permission)
            val dialog = AudioPermissionDialog(error)
            dialog.show(requireActivity().supportFragmentManager, "AudioPermissionDialog")
        }
    }
```
ActivityReusltContractì˜ RequestPermissionì„ í†µí•´ Audio ê¶Œí•œì„ ìš”ì²­í•œë‹¤.

ActivityContractì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì€ [ë‹¤ìŒ ê²Œì‹œê¸€](https://915dbfl.github.io/android/activity_result_api/)ì„ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.

<br>

ìŒì„± ì¸ì‹ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•˜ë ¤ë©´ `SpeechRecognizer` í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤. í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” `createSpeechRecognizer`ë¥¼ í†µí•´ì„œ SpeechRecognizer í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤.

ë˜í•œ, ìŒì„± ì¸ì‹ì„ ì‹¤í–‰í•˜ë ¤ë©´ intentë¥¼ ìƒì„±í•´ì•¼ í•˜ëŠ”ë° `RecognizerIntent`ë¥¼ ì‚¬ìš©í•œë‹¤.

```kotlin
 override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        val speechRecognizer = SpeechRecognizer.createSpeechRecognizer(context)
        val speechRecognizerIntent = Intent(RecognizerIntent.ACTION_RECOGNIZE_SPEECH)
        //ìŒì„± ì¸ì‹ì˜ ìŒì„± ëª¨ë¸ ì •ë³´ ì„¤ì •
        speechRecognizerIntent.putExtra(RecognizerIntent.EXTRA_LANGUAGE_MODEL, RecognizerIntent.LANGUAGE_MODEL_FREE_FORM)
        //ìŒì„± ì¸ì‹ì˜ ì¸ì‹ë˜ëŠ” ì–¸ì–´ ì„¤ì •
        speechRecognizerIntent.putExtra(RecognizerIntent.EXTRA_LANGUAGE, "ko-KR")

        ...
```

<br>

ë‹¤ìŒìœ¼ë¡œ listenerë¥¼ ì •ì˜í•´ ìŒì„± ì¸ì‹ ê³¼ì •ì„ ì²˜ë¦¬í•œë‹¤.

ì´ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ `RecognitionListener`ì´ë‹¤.

```kotlin
    private val recognitionListener: RecognitionListener = object: RecognitionListener {
        //ë§í•˜ê¸° ì‹œì‘í•  ì¤€ë¹„ê°€ ë  ë•Œ í˜¸ì¶œ
        override fun onReadyForSpeech(p0: Bundle?) {
            TODO("Not yet implemented")
        }
    
        //ë§í•˜ê¸° ì‹œì‘í•  ë•Œ í˜¸ì¶œ
        override fun onBeginningOfSpeech() {
            TODO("Not yet implemented")
        }

        //ì‚¬ìš´ë“œ í¬ê¸°ê°€ ë‹¬ë¼ì¡Œì„ ë•Œ í˜¸ì¶œ
        override fun onRmsChanged(p0: Float) {
            TODO("Not yet implemented")
        }

        //ë§í•˜ê¸° ì‹œì‘í•˜ê³  ë” ë§ì€ ë‹¨ì–´ë“¤ì´ ì¸ì‹ë˜ì—ˆì„ ë•Œ í˜¸ì¶œ
        override fun onBufferReceived(p0: ByteArray?) {
            TODO("Not yet implemented")
        }

        //ë§í•˜ê¸°ê°€ ëë‚¬ì„ ë•Œ í˜¸ì¶œ
        override fun onEndOfSpeech() {
            TODO("Not yet implemented")
        }

        //ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ í˜¸ì¶œ
        override fun onError(p0: Int) {
            TODO("Not yet implemented")
        }

        //ì¸ì‹ ê²°ê³¼ê°€ ì¤€ë¹„ë˜ë©´ í˜¸ì¶œ
        override fun onResults(p0: Bundle?) {
            TODO("Not yet implemented")
        }

        //ë¶€ë¶„ì ìœ¼ë¡œ ì¸ì‹ëœ ê²°ê³¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ë•Œ í˜¸ì¶œ
        override fun onPartialResults(p0: Bundle?) {
            TODO("Not yet implemented")
        }

        //í–¥í›„ ì´ë²¤íŠ¸ë¥¼ ì˜ˆì•½
        override fun onEvent(p0: Int, p1: Bundle?) {
            TODO("Not yet implemented")
        }

    }
```

<br>

ì´ë ‡ê²Œ ì‘ì„±í•œ ë¦¬ìŠ¤ë„ˆë¥¼ ì´ì œ `SpeechRecognizer`ì— ì„¤ì •í•˜ë©´ ëœë‹¤.

```kotlin
    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        ...

        speechRecognizerIntent.putExtra(RecognizerIntent.EXTRA_LANGUAGE, "ko-KR")
        //ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        speechRecognizer.setRecognitionListener(recognitionListener) 
```

ì´ë ‡ê²Œ í•˜ë©´ sttë¥¼ ì‚¬ìš©í•  ì¤€ë¹„ê°€ ë˜ì—ˆë‹¤!!!

<br>

ì´ì œ ì§ì ‘ ì‚¬ìš©í•´ë³´ì!!
```kotlin
//ìŒì„± ì¸ì‹ ì‹œì‘
speechRecognizer.startListening(speechRecognizerIntent)

//ìŒì„± ì¸ì‹ ì¢…ë£Œ
speechRecognizer.stopListening()
```

ìœ„ì˜ ì‹œì‘/ì¢…ë£Œ ì½”ë“œë¥¼ ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ ì†ì— ì‘ì„±í•˜ëŠ” ë“± í•„ìš”í•œ ë¶€ë¶„ì—ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤!

<br>

## â¡ï¸ ì „ì²´ ì½”ë“œ
```kotlin
    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        val speechRecognizer = SpeechRecognizer.createSpeechRecognizer(context)
        val speechRecognizerIntent = Intent(RecognizerIntent.ACTION_RECOGNIZE_SPEECH)
        speechRecognizerIntent.putExtra(RecognizerIntent.EXTRA_LANGUAGE_MODEL, RecognizerIntent.LANGUAGE_MODEL_FREE_FORM)
        speechRecognizerIntent.putExtra(RecognizerIntent.EXTRA_LANGUAGE, "ko-KR")
        speechRecognizer.setRecognitionListener(recognitionListener)

        binding.btnRadioPlay.setOnClickListener {
            if (isPermissionGranted()) {
                speechRecognizer.startListening(speechRecognizerIntent)
            } else{
                requestAudioLauncher.launch(Manifest.permission.RECORD_AUDIO)
            }

        }

        binding.btnRadioStop.setOnClickListener {
            speechRecognizer.stopListening()
        }
    }

    private fun isPermissionGranted(): Boolean {
        return !(Build.VERSION.SDK_INT >= 23 &&
                ContextCompat.checkSelfPermission(requireContext(), Manifest.permission.RECORD_AUDIO) != PackageManager.PERMISSION_GRANTED)
    }

    private val requestAudioLauncher = registerForActivityResult(
        ActivityResultContracts.RequestPermission()) { isGranted ->
        if (!isGranted) {
            val error = resources.getString(R.string.dialog_permission)
            val dialog = AudioPermissionDialog(error)
            dialog.show(requireActivity().supportFragmentManager, "AudioPermissionDialog")
        }
    }


    private val recognitionListener: RecognitionListener = object: RecognitionListener {
        override fun onReadyForSpeech(p0: Bundle?) {}

        override fun onBeginningOfSpeech() {
            binding.btnRadioPlay.visibility = View.GONE
            binding.btnRadioStop.visibility = View.VISIBLE
        }

        override fun onRmsChanged(p0: Float) {}

        override fun onBufferReceived(p0: ByteArray?) {}

        override fun onEndOfSpeech() {
            binding.btnRadioStop.visibility = View.GONE
            binding.btnRadioPlay.visibility = View.VISIBLE
        }

        override fun onError(p0: Int) {
            val message = when (p0) {
                SpeechRecognizer.ERROR_AUDIO -> resources.getString(R.string.stt_audio_error)
                SpeechRecognizer.ERROR_INSUFFICIENT_PERMISSIONS -> resources.getString(R.string.stt_permission_error)
                SpeechRecognizer.ERROR_NETWORK -> resources.getString(R.string.stt_network_error)
                SpeechRecognizer.ERROR_SPEECH_TIMEOUT -> resources.getString(R.string.stt_time_error)
                else -> resources.getString(R.string.stt_default_error)
            }

            //ë©”ì„¸ì§€ ì²˜ë¦¬
            Log.d("error", message)
        }

        override fun onResults(p0: Bundle?) {
            p0?.let {
                val content: ArrayList<String>? =
                    p0.getStringArrayList(SpeechRecognizer.RESULTS_RECOGNITION)

                content.let {
                    //ê²°ê³¼ê°’ ì²˜ë¦¬
                    Log.d("result", content!!)
                }
            }
        }

        override fun onPartialResults(p0: Bundle?) {}

        override fun onEvent(p0: Int, p1: Bundle?) {}

    }
```

<br>

**ğŸ™‡â€â™€ï¸ ë¶€ì¡±í•œ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ë§ì”€í•´ì£¼ì„¸ìš”! ê°ì‚¬í•©ë‹ˆë‹¤!**

<br>

## ğŸ“ƒì°¸ê³ 
* ê³µì‹ ë¬¸ì„œ
    * <https://developer.android.com/reference/android/speech/SpeechRecognizer>
    * <https://developer.android.com/reference/android/speech/RecognizerIntent>
    * <https://developer.android.com/reference/android/speech/RecognitionListener>
* ê·¸ ì™¸
    * <https://naver.github.io/naverspeech-sdk-android/index.html?com/naver/speech/clientapi/SpeechRecognizer.html>
    * <https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=horajjan&logNo=220329237271>
    * <https://ebbnflow.tistory.com/188>