---
title: "[Android] kakao map ì‚¬ìš©í•˜ê¸°"
categories:
  - Android
tag:
  - kakao map

last_modified_at: 2023-05-01
toc: true
toc_sticky: true
search: true
---

# ğŸ™‹â€â™€ï¸ kakao sdk ì‚¬ìš© ì´ˆê¸° ì„¤ì •

ìš°ì„  ê¸°ë³¸ì ìœ¼ë¡œ kakao sdk ì‚¬ìš©ì„ ìœ„í•´ í”„ë¡œì íŠ¸ë¥¼ ë“±ë¡í•˜ê³  app keyë¥¼ ë°›ì•„ì˜¤ëŠ” ê²ƒê¹Œì§€ ë§ˆë¬´ë¦¬í–ˆë‹¤ëŠ” ê°€ì •í•˜ì— ê·¸ ë‹¤ìŒ ë‹¨ê³„ë¶€í„° ì°¨ê·¼ì°¨ê·¼ ì •ë¦¬í•´ë³´ê³ ì í•œë‹¤.

# ğŸ™‹â€â™€ï¸ kakao map sdk ë‹¤ìš´
ìš°ì„  kakao mapì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” í•„ìš”í•œ sdkë¥¼ ë‹¤ìš´ë°›ì•„ì•¼ í•œë‹¤. ë‹¤ìŒ [ê³µì‹ ë¬¸ì„œ](https://apis.map.kakao.com/android/guide/)ì—ì„œ sdkë¥¼ ë‹¤ìš´ë°›ì•„ ì••ì¶•ì„ í’€ì–´ì£¼ë©´ ë‹¤ìŒì˜ í´í„°, íŒŒì¼ì„ ì–»ì„ ìˆ˜ ìˆë‹¤.

* libDaumMapAndroid.jar
* ì•„í‚¤í…ì³ë³„ë¡œ libMapEngineApi.so ì„¸ ê°œì˜ ë°”ì´ë„ˆë¦¬ íŒŒì¼

ìš°ì„  libDaumMapAndroid.jar íŒŒì¼ì€ /app/libs/ì— ë³µì‚¬ë¥¼ í•˜ê³ , libMapEngineApi.so íŒŒì¼ì€ /app/source/main/jniLibs í´ë”ë¥¼ ë§Œë“¤ì–´ ê·¸ ì•ˆì— ë³µì‚¬í•´ì£¼ë©´ ëœë‹¤. 

<img src = "https://drive.google.com/uc?id=14WPMyIGDY9OR9XJZRohM0yjmQYVYFvpY" width = 400 height = 500>

ì´ì œ ë“±ë¡í•œ jar íŒŒì¼ì˜ dependencyë¥¼ ì¶”ê°€í•´ì¤˜ì•¼ í•œë‹¤! ìš°ì„  File -> Project Structureë¡œ ë“¤ì–´ê°€ ì™¼ìª½ ë©”ë‰´ì˜ Dependenciesë¥¼ í´ë¦°í•œë‹¤. Modules ë¶€ë¶„ì€ appì„ ì„ íƒí•˜ê³  Declared Dependenciesì˜ +ë¥¼ ëˆŒëŸ¬ jar dependencyë¥¼ ì¶”ê°€í•œë‹¤.

<img src = "https://drive.google.com/uc?id=1kcIk6AYoDtb3Cafp9ELjT3HGHQZCcLdX" width = 500 height = 300>


<img src = "https://drive.google.com/uc?id=1KME5keOy22cE_RHdvaTgIkJ0K9Fz6dlo" width = 500 height = 350>

ì—¬ê¸°ì„œ step1ì—ëŠ” src\main\jniLibsë¥¼ ì…ë ¥í•˜ê³ , step2ì—ëŠ” implementationì„ ì„ íƒí•œ í›„ Apply, Ok ë²„íŠ¼ì„ í´ë¦­í•´ ì ìš©ì„ í•œë‹¤.

ì—¬ê¸°ê¹Œì§€ ì§„í–‰í–ˆë‹¤ë©´ build íŒŒì¼ì— ë‹¤ìŒì˜ dependencyê°€ ì¶”ê°€ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì! ê·¸ë¦¬ê³  ë§Œì•½ ì¶”ê°€ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ ì•„ë˜ì˜ ì½”ë“œë¥¼ ì¶”ê°€í•´ë¼!

```
    //kakao map
    implementation files('libs/libDaumMapAndroid.jar')
```

ì´ì œ ë§ˆì§€ë§‰ìœ¼ë¡œ manifestì—ì„œ permission ë° app keyë¥¼ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤.

```
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    // internet ë° location ê¶Œí•œâ­ï¸
    <uses-permission android:name="android.permission.INTERNET"/>
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/>
    <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/>

    <application
        android:usesCleartextTraffic="true // ì•”í˜¸í™” ë˜ì§€ ì•Šì€ ì„œë²„ì™€ í†µì‹ ì´ í•„ìš”í•¨â­ï¸
        android:name=".presentation.base.GlobalApplication"
        android:allowBackup="true"
        android:dataExtractionRules="@xml/data_extraction_rules"
        android:fullBackupContent="@xml/backup_rules"
        android:icon="@drawable/ic_sopar_logo"
        android:label="@string/app_name"
        android:supportsRtl="true"
        android:theme="@style/Theme.Sopar.Splash"
        tools:targetApi="31">
        <activity
            android:name="com.kakao.sdk.auth.AuthCodeHandlerActivity"
            android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                <data android:host="oauth"
                    android:scheme="kakao${NATIVE_APP_KEY}" />
            </intent-filter>
        </activity>
...

        // app key ì¶”ê°€â­ï¸
        <meta-data android:name="com.kakao.sdk.AppKey" android:value="${NATIVE_APP_KEY}"/>

    </application>
</manifest>
```
* ì¹´ì¹´ì˜¤ ë§µ api í˜¸ì¶œì—ì„œëŠ” httpê°€ ì‚¬ìš©ë˜ë¯€ë¡œ ìœ„ì˜ usesCleartextTrafficë¥¼ trueë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.
* ê³µì‹ë¬¸ì„œì—ì„œëŠ” ACCESS_FINE_LOCATION ê¶Œí•œë§Œì„ ì„¤ì •í•˜ì§€ë§Œ í•´ë‹¹ ê¶Œí•œë§Œì„ ì„¤ì •í•˜ë©´ ë‹¤ìŒì˜ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.
  * If you need access to FINE location, you must request both ACCESS_FINE_LOCATION and ACCESS_COARSE_LOCATION
  * ë”°ë¼ì„œ wifië‚˜ ê¸°ì§€êµ­ ì‹ í˜¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” ACCESS_COARSE_LOCATION ê¶Œí•œë„ í•¨ê»˜ ì„¤ì •í•´ì¤€ë‹¤.

ê·¸ë ‡ë‹¤ë©´ ì´ì œ ì¹´ì¹´ì˜¤ ë§µì„ í™”ë©´ì— ë„ì–´ë³´ì!

# ğŸ™‹â€â™€ï¸ MapView ì‚¬ìš©í•˜ê¸°

## âœ“ ì¹´ì¹´ì˜¤ë§µ í™”ë©´ì— ë„ìš°ê¸°

í™”ë©´ì— ì§€ë„ë¥¼ ë„ìš°ê¸° ìœ„í•´ì„œëŠ” net.daum.mf.map.api.MapViewë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤.

```
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".presentation.map.MapFragment">

    <net.daum.mf.map.api.MapView
        android:id="@+id/map_view"
        android:layout_width="match_parent"
        android:layout_height="match_parent"/>

</androidx.constraintlayout.widget.ConstraintLayout>
```
MapViewë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” net.daum.android.map.MapViewì™€ í—·ê°ˆë¦¬ì§€ ì•Šë„ë¡ í•œë‹¤!

ì—¬ê¸°ê¹Œì§€ ì§„í–‰í•˜ë©´ ì•„ë˜ ì‚¬ì§„ê°™ì´ ë§µì´ ì˜ ì¶œë ¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

<img src = "https://drive.google.com/uc?id=1HBoWOJMOYU-_5XV1tv4uHyrxODq_j7Vf" width = 250 height = 500>

ë³¸ê²©ì ìœ¼ë¡œ ë§µì„ ì‚¬ìš©í•˜ê¸° ì „ì— í•„ìš”í•œ ê¶Œí•œ ìŠ¹ì¸ ì‘ì—…ì´ í•„ìš”í•˜ë‹¤!

## âœ“ ê¶Œí•œ ìŠ¹ì¸ ì§„í–‰í•˜ê¸°

ê¶Œí•œ ìŠ¹ì¸ì€ registerForActivityResultì™€ ActivityResultContractsë¥¼ ì‚¬ìš©í•´ ì§„í–‰í•˜ê³ ì í•œë‹¤.

ìš°ì„  ê¶Œí•œì´ ìŠ¹ì¸ë˜ì—ˆëŠ”ì§€ë¥¼ ë¨¼ì € ContextCompat.checkSelfPermissionë¥¼ í†µí•´ í™•ì¸í•´ì¤€ë‹¤.

```kotlin
    private fun isAllPermissionsGranted(): Boolean = REQUIRED_PERMISSIONS.all { permission ->
        ContextCompat.checkSelfPermission(requireContext(), permission) ==
                PackageManager.PERMISSION_GRANTED
    }
```

ë§Œì•½ ìŠ¹ì¸ì´ í•„ìš”í•˜ë‹¤ë©´ ê¶Œí•œì— ëŒ€í•œ ìŠ¹ì¸ ìš”ì²­ì„ ì§„í–‰í•˜ë©´ ëœë‹¤. ìš°ì„  ê·¸ ê³¼ì •ì—ì„œ ì‚¬ìš©í•  requestPermissionLauncherë¥¼ ì •ì˜í•´ì¤€ë‹¤.

```kotlin
    private val requestPermissionLauncher =
        registerForActivityResult(ActivityResultContracts.RequestMultiplePermissions()) { permissions ->
            permissions.entries.forEach { permission ->
                when {
                    //ê¶Œí•œì„ ìŠ¹ì¸í•˜ì˜€ì„ ë–„
                    permission.value -> {
                        Toast.makeText(requireContext(), "í•„ìš”í•œ ê¶Œí•œì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!", Toast.LENGTH_SHORT).show()
                    }
                    //ê¶Œí•œì„ ì™„ì „íˆ ê±°ë¶€í–ˆì„ ê²½ìš°
                    shouldShowRequestPermissionRationale(permission.key) -> {
                        Toast.makeText(requireContext(), "ì„¤ì •ì—ì„œ ê¶Œí•œì„ ìŠ¹ì¸í•´ì£¼ì„¸ìš”!", Toast.LENGTH_SHORT).show()
                    }
                    //ê¶Œí•œì„ ìŠ¹ì¸í•˜ì§€ ì•Šì€ ê²½ìš°
                    else -> {
                        Toast.makeText(requireContext(), "ì„¤ì •ì—ì„œ ê¶Œí•œì„ ìŠ¹ì¸í•´ì£¼ì„¸ìš”!", Toast.LENGTH_SHORT).show()
                    }
                }
            }
        }
```

ì´ì œ ì´ë¥¼ ì´ìš©í•´ í•„ìš”í•œ ê¶Œí•œì„ ìš”ì²­í•œë‹¤.

```kotlin
        if (!isAllPermissionsGranted()) {
          //í•„ìš”í•œ ê¶Œí•œì´ ìŠ¹ì¸ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°
            requestPermissionLauncher.launch(REQUIRED_PERMISSIONS)
        }
```

ì—¬ê¸°ì„œ í•„ìš”í•œ ê¶Œí•œì€ companion object ì† ë°°ì—´ í˜•íƒœë¡œ ë¯¸ë¦¬ ì •ì˜í•´ì£¼ì—ˆë‹¤.

```kotlin
    companion object {
        private val REQUIRED_PERMISSIONS = arrayOf(
            android.Manifest.permission.ACCESS_COARSE_LOCATION,
            android.Manifest.permission.ACCESS_FINE_LOCATION,
            android.Manifest.permission.INTERNET
        )
    }
```

ì´ë ‡ê²Œ í•œë‹¤ë©´ ì´ì œ í•„ìš”í•œ ê¶Œí•œì´ ëª¨ë‘ ìŠ¹ì¸ë˜ì—ˆë‹¤. 

ì´ì œ ì¹´ì¹´ì˜¤ë§µì„ í™œìš©í•˜ëŠ” ë‹¨ê³„ë§Œ ë‚¨ì•˜ë‹¤! í•´ë‹¹ ë‚´ìš©ì— ëŒ€í•´ì„œëŠ” ì¶”í›„ ê²Œì‹œê¸€ì„ í†µí•´ ì •ë¦¬í•´ë³´ê² ë‹¤!

<br>

-----

## (2023.05.12) ì¶”ê°€ ì •ë¦¬ ë¶€ë¶„

hiltì™€ í•¨ê»˜ kakao mapì„ ì‚¬ìš©í•  ê²½ìš°, xmlì—ì„œ ë°”ë¡œ MapViewë¥¼ ì‚¬ìš©í•  ê²½ìš°

```
Caused by: android.view.InflateException: Binary XML file line #12 in org.sopar:layout/fragment_map: Error inflating class net.daum.mf.map.api.MapView
```

ìœ„ì˜ ì˜¤ë˜ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤. ë”°ë¼ì„œ addViewë¥¼ í†µí•´ MapViewë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì„ ì ìš©í•´ì•¼ í•œë‹¤.

```xml
   <RelativeLayout
        android:id="@+id/map_view"
        android:layout_width="match_parent"
        android:layout_height="match_parent"/>

```

```kotlin
    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        mapView = MapView(requireActivity())
        binding.mapView.addView(mapView)
        ...
```

<br>

**ğŸ™‡â€â™€ï¸ ë¶€ì¡±í•œ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ë§ì”€í•´ì£¼ì„¸ìš”! ê°ì‚¬í•©ë‹ˆë‹¤!**

<br>

## ğŸ“ƒì°¸ê³ 
* <https://apis.map.kakao.com/android/guide/>
* <https://m.blog.naver.com/bgpoilkj/222826006726>