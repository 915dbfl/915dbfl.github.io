---
title: "[Android] Retrofit"
excerpt: "ì•ˆë“œë¡œì´ë“œ í†µì‹  ë¼ì´ë¸ŒëŸ¬ë¦¬"
categories:
  - Android
tag:
  - android 
  - kotlin
  - retrofit
  - android http client
  - retrofit2

last_modified_at: 2022-04-22
toc: true
toc_sticky: true
search: true
---


ğŸ‘© ì´ë²ˆ ì‹œê°„ì—ëŠ” Retrofit ì‚¬ìš©ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê³ ì í•œë‹¤!

## ğŸ™‹â€â™€ï¸Retrofit?

> [retrofit ê³µì‹ ë§í¬](https://square.github.io/retrofit/)

retrofitì€ **ì•ˆë“œë¡œì´ë“œ í†µì‹ ** ê¸°ëŠ¥ì„ ì‰½ê²Œ ê°œë°œí•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. [Rest](https://gmlwjd9405.github.io/2018/09/21/rest-and-restful.html) ê¸°ë°˜ ì›¹ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ì„œ JSON ì„ ê²€ìƒ‰í•˜ê³  ì—…ë¡œë“œ í•  ìˆ˜ ìˆë‹¤.


ğŸ™„ ì¦‰, retrofitì„ ì‚¬ìš©í•´ ì„œë²„ì—ê²Œ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ê±°ë‚˜ ì„œë²„ë¡œë¶€í„° í•„ìš”í•œ ë°ì´í„°ë¥¼ ì‰½ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. 

ì´ˆê¸° ì•ˆë“œë¡œì´ë“œì—ì„œëŠ” HttpClientë¥¼ í†µí•´ ì„œë²„ì™€ í†µì‹ í•˜ì˜€ìœ¼ë‚˜ Anroid 5.1 ì´í›„ deprecatedê°€ ë˜ë©´ì„œ retrofitì´ ì„œë²„ í†µì‹ ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë˜ì—ˆë‹¤.

<br>

## ğŸ™‹â€â™€ï¸ Retrofit ì‚¬ìš© ë°©ë²•

ìš°ì„  Retrofitì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ìš”ì†Œë¶€í„° í™•ì¸í•´ë³´ì.
1. ì‘ë‹µìœ¼ë¡œ ë°›ì•„ì˜¬ **JSONì˜ ëª¨ë¸ í´ë˜ìŠ¤**(<u>data class</u> ì‚¬ìš©!)

2. HTTP ì‘ì—…ì„ ì •ì˜í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤


ê·¸ë ‡ë‹¤ë©´ ì§€ê¸ˆë¶€í„° ë‹¨ê³„ë³„ë¡œ Retrofit ì‚¬ìš©ë²•ì„ ì •ë¦¬í•´ë³´ê³ ì í•œë‹¤. í•„ìì˜ ê²½ìš°, **íšŒì›ì˜ ì´ë©”ì¼ê³¼ ì´ë¦„**ì„ ì„œë²„ì—ê²Œ ë„˜ê²¨ì£¼ê³  **íšŒì› ì •ë³´(ì´ë©”ì¼, id, ì´ë¦„)**ì„ ì„œë²„ë¡œë¶€í„° ë°›ì•„ì˜¤ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ë‹¤!

----
### ğŸ™‹â€â™€ï¸ Retrofitì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í™˜ê²½ì„¤ì •
1. Gradle: Retrofit ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€!
  ```
      implementation 'com.squareup.retrofit2:retrofit:2.9.0'
      implementation 'com.squareup.retrofit2:converter-gson:2.9.0'
  ```
  (ğŸ˜Š ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë²„ì „ì€ ìµœì‹  ë²„ì „ìœ¼ë¡œ ë°”ê¾¸ì–´ ì‚¬ìš©í•´ì£¼ì„¸ìš”!)

2. AndroidManifest: internet permission ì¶”ê°€!
  ```
    <uses-permission android:name="android.permission.INTERNET"/>
  ```

<br>
----

### ğŸ™‹â€â™€ï¸ ëª¨ë¸ í´ë˜ìŠ¤ ìƒì„±í•˜ê¸°
ëª¨ë¸ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ì´ì „ì— **ì„œë²„ë¡œë¶€í„° ë°›ì„ responseì˜ íƒ€ì…**ì„ íŒŒì•…í•´ì•¼ í•œë‹¤.

```
{
  "email": "string",
  "userId": 0,
  "userName": "string"
}
```
ìœ„ì™€ ê°™ì€ ì‘ë‹µì„ ë°›ê¸° ìœ„í•´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ëª¨ë¸ í´ë˜ìŠ¤ê°€ í•„ìš”í•˜ë‹¤.
```
data class UserInfo(
    @SerializedName("userId") var userId: Int?,
    @SerializedName("email") var email: String?,
    @SerializedName("userName") var userName: String?
)

```
ğŸ™„ ìë°”ì—ì„œëŠ” ëª¨ë¸ í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´ì„œëŠ” getterì™€ setter ë“±ì˜ ì¶”ê°€ì ì¸ ì½”ë“œë¥¼ êµ¬í˜„í•´ì¤˜ì•¼ í•œë‹¤.

í•˜ì§€ë§Œ ì½”í‹€ë¦°ì—ì„œì˜ **data class**ëŠ” getter, setter ë“±ì˜ ì¶”ê°€ì ì¸ ì½”ë“œê°€ ìë™ìœ¼ë¡œ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ë”°ë¡œ êµ¬í˜„í•  í•„ìš”ê°€ ì—†ë‹¤.

* ```@SerializedName```ëŠ” **í”„ë¡œí¼í‹° ë³€ìˆ˜ëª…**ì„ **ì‹¤ì œ ì„œë²„ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê°’**ê³¼ **<u>ë‹¬ë¦¬</u>** í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ í˜¹ì‹œ ëª¨ë¥¼ ì˜¤ë¥˜ë¥¼ ìœ„í•´ì„œ ì„œë²„ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê°’ê³¼ ë™ì¼í•œ ê°’ì„ ì‚¬ìš©í•˜ë”ë¼ë„ í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì£¼ëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤.

<br>
---

### ğŸ™‹â€â™€ï¸ Retrofit Interface ìƒì„±í•˜ê¸°
```
interface ApiInterface {

    @POST("v1/user")
    fun addUser(@Body userData: UserInfo): Call<UserInfo>

    companion object{
        var BASE_URL = "ğŸŒŸì„œë²„ì˜ ê¸°ë³¸ URL ì£¼ì†ŒğŸŒŸ"

        fun create(): ApiInterface{
            val retrofit = Retrofit.Builder()
                .addConverterFactory(GsonConverterFactory.create())
                .baseUrl(BASE_URL)
                .build()
            return retrofit.create(ApiInterface::class.java)
        }
    }
}
```
1. **HTTP annotation**

    ğŸ™„ ìœ„ì—ì„œëŠ” ```@POST```ë¥¼ ì‚¬ìš©í•´ POST ë©”ì†Œë“œë¥¼ ì‘ì„±í•˜ê³  ìˆë‹¤. ì´ì™¸ì— ```HTTP, GET, PUT, PATCH, DELETE, OPTIONS, HEAD```ì˜ ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 

    ì´ë²ˆ ê²Œì‹œê¸€ì—ì„œëŠ” **POST ë©”ì†Œë“œ**ë¥¼ ìœ„ì£¼ë¡œ ì‚´í´ë³´ê³ ì í•œë‹¤! ìì„¸í•œ ë‚´ìš©ì€ [ê³µì‹ë¬¸ì„œ](https://square.github.io/retrofit/)ë¥¼ í™•ì¸í•˜ê¸¸ ë°”ë€ë‹¤!

<br>

2. **request body**
  ```
      @POST("v1/user")
      fun addUser(ğŸ””@Body userData: UserInfo): Call<UserInfo>
  ```
  ë§Œì•½ ì„œë²„ ìš”ì²­ ì‹œ **request body**ê°€ í•„ìš”í•˜ë‹¤ë©´ ìœ„ì™€ ê°™ì´ ```@Body```ë¥¼ í†µí•´ì„œ ì§€ì •í•´ì¤„ ìˆ˜ ìˆë‹¤!

<br>

3. **@POST("v1/user")**

    ì—¬ê¸° ì‘ì„±í•˜ëŠ” ì£¼ì†Œë¥¼ í†µí•´ì„œ ìµœì¢…ì ìœ¼ë¡œ ```BASE_URL/v1/user```ê°€ ìš”ì²­ ì£¼ì†Œê°€ ë˜ëŠ” ê²ƒì´ë‹¤!

<br>

4. **@Path: ì£¼ì†Œ ì¡°ì‘!**

    ì„œë²„ ìš”ì²­ ì£¼ì†Œê°€ ì¼ê´€ë˜ì§€ ì•Šê³  <u>íŠ¹ì • ê°’ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ë•Œ</u>ëŠ” **@Path**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

    ```"v1/user/{id}"```ê°€ ìš”ì²­ ì£¼ì†Œê°€ ë  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ POST ë©”ì†Œë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
    ```
          @POST("v1/user/{id}")
          fun addUser(@Path("id")id: Int): Call<UserInfo>
    ```

<br>
---

### ğŸ™‹â€â™€ï¸ ì„œë²„ ìš”ì²­/ì‘ë‹µ
```
        ApiInterface.create().checkUser(userInfo).enqueue(
            object : retrofit2.Callback<userInfo>{
                override fun onResponse(call: Call<Data>, response: Response<Data>) {
                    if(response.isSuccessful){
                        userInfo = response.body()!!.user
                        oauthInfo = response.body()!!.oauth
                        val data = Data(oauthInfo, userInfo)
                        gotoMain(data)
                    }else{
                        if(response.code() == 404){
                            Toast.makeText(context, "íšŒì› ê°€ì…ì„ ë¨¼ì € ì§„í–‰í•´ì£¼ì„¸ìš”!ğŸ˜Š", Toast.LENGTH_SHORT).show()
                        }
                        Log.d("response", "responseCode: ${response.code()}")
                    }
                }

                override fun onFailure(call: Call<Data>, t: Throwable) {
                    Log.d("postApi", "error: ${t.toString()}")
                }
            }
        )
```
* ApiInterface.create()ë¡œ Retrofit ê°ì²´ ê°€ì ¸ì˜¨ë‹¤.
* **enqueue()**ë¡œ Retrofitì€ ì„œë²„ì™€ ë¹„ë™ê¸°ë¡œ í†µì‹ í•˜ê²Œ ëœë‹¤.
* ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ **ì‘ë‹µ**ì€ **response**ì— ì €ì¥ë˜ê²Œ ëœë‹¤.
  * **response.body()**ë¥¼ í†µí•´ì„œ ê°’ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
* request bodyë¡œ emailê³¼ ì´ë¦„ì´ í•„ìš”í•˜ë¯€ë¡œ ìœ„ì—ì„œ ì‘ì„±í•œ UserInfo ë°ì´í„° í´ë˜ìŠ¤ë¥¼ ë„˜ê²¨ì£¼ì—ˆë‹¤.

  ğŸ””ì—¬ê¸°ì„œ ì ê¹!ğŸ””

  * userInfoëŠ” userId, email, userNameìœ¼ë¡œ êµ¬ì„±ëœ data classì¸ë° **userIdëŠ” ë¬´ìŠ¨ ê°’ì„ ë„£ì–´ì„œ ë³´ë‚´ì¤˜ì•¼ í• ê¹Œ??**
    * ì„œë²„ ìš”ì²­ì„ ìœ„í•´ í•„ìš”í•œ ê°’ì€ emailê³¼ userNameì´ë‹¤. ë”°ë¼ì„œ userId ë¶€ë¶„ì€ **nullable**ë¡œ ì„¤ì •í•´ **nullê°’ì„ ë„£ê³  ë„˜ê²¨ì£¼ë©´ ëœë‹¤.**


## ğŸ“ƒì°¸ê³ 
* <https://square.github.io/retrofit/>
* <https://howtodoandroid.com/retrofit-android-example-kotlin/>
* <https://s2choco.tistory.com/28>
* <https://stackoverflow.com/questions/30180957/send-post-request-with-params-using-retrofithttps://question0.tistory.com/12>
* <https://velog.io/@ptm0304/Kotlin-Retrofit-POST-pok3a6b8a8>
* <https://stickode.tistory.com/43>
* <https://medium.com/androiddevelopers/31daysofkotlin-week-2-recap-9eedcd18ef8>
* <https://cishome.tistory.com/137>
